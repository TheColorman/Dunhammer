<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Redirecting...</title>
    </head>
    <body>
        Redirecting...
        <script>
            (async () => {
                const res = await fetch("/api/discord/login", {
                    method: "GET",
                });
                const json = await res.json();
                const state = json.state;
                const clientID = json.client_id;

                document.cookie = `state=${state};`;

                const currentURLArr = window.location.href.split("/");
                const redirectURI = `${currentURLArr[0]}//${currentURLArr[2]}/api/discord/callback`;

                const redirect = `https://discord.com/api/oauth2/authorize?client_id=${clientID}&redirect_uri=${redirectURI}&response_type=code&scope=email%20guilds&state=${state}`;

                window.location.href = redirect;
            })();
        </script>
    </body>
</html>
